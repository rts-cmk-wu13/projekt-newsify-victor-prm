import{s as r,c}from"./nav-footer-CTn4aQNw.js";function p(){return"ZIlfSqviIIl000Si2V335gWv3C2zzGyL"}const l=p(),f=2;function u(e){const t=localStorage.getItem(e);return t?(Date.now()-Number(t))/(1e3*60)>f:!0}function m(e){localStorage.setItem(e,Date.now())}function h(e,t){let s=e,n=t;return n!=""&&n.length<s.length&&(s=n),s}async function w(e){if(u("articlesCategoryTimestamp")){console.log("Fetching fresh articles from API...");let t=`https://api.nytimes.com/svc/search/v2/articlesearch.json?q=${e}&begin_date=${g()}&api-key=${l}&sort=newest`;const n=await(await fetch(t)).json();console.log(n);const o=n.response.docs.filter(a=>a.multimedia.thumbnail.url!==void 0&&a.multimedia.thumbnail.url!=="").map(a=>({id:a.uri,title:h(a.headline.main,a.headline.print_headline),abstract:a.abstract,thumbnail:a.multimedia.thumbnail.url,byline:a.byline.original,category:e,pub_date:a.pub_date,url:a.web_url}));return await r(o),m("articlesCategoryTimestamp"),o}else{console.log("Loading articles from cache...");const t=await c(e);return t.sort(function(s,n){return new Date(n.pub_date)-new Date(s.pub_date)}),t}}function g(){const e=new Date,t=new Date;return t.setDate(e.getDate()-7),(o=>o.toISOString().slice(0,10).replace(/-/g,""))(t)}async function y(e){if(u("articlesPopularTimestamp")){console.log("Fetching fresh articles from API...");let t=e.toLowerCase().replaceAll(" ","-");switch(t){case"today":t=1;break;case"this-week":t=7;break;case"this-month":t=30;break}let s=`https://api.nytimes.com/svc/mostpopular/v2/viewed/${t}.json?api-key=${l}`;const a=(await(await fetch(s)).json()).results.filter(i=>i.media&&i.media.length>0).map(i=>({id:i.uri,title:i.title,abstract:i.abstract,thumbnail:i.media[0]["media-metadata"][0].url||0,byline:i.byline.original,category:e,pub_date:i.published_date,url:i.url})).sort(function(i,d){return new Date(d.pub_date)-new Date(i.pub_date)});return console.log(a),await r(a),m("articlesPopularTimestamp"),a}else{console.log("Loading articles from cache...");const t=await c(e);return t.sort(function(s,n){return new Date(n.pub_date)-new Date(s.pub_date)}),t}}export{y as a,w as f};
